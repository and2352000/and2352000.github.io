<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Code on Aaron's Blog</title><link>https://and2352000.github.io/tags/code/</link><description>Recent content in Code on Aaron's Blog</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Mon, 26 Feb 2024 15:07:57 +0800</lastBuildDate><atom:link href="https://and2352000.github.io/tags/code/index.xml" rel="self" type="application/rss+xml"/><item><title>Manage Nodejs Heap in Docker</title><link>https://and2352000.github.io/posts/7-manage-nodejs-heap-in-docker/</link><pubDate>Mon, 26 Feb 2024 15:07:57 +0800</pubDate><guid>https://and2352000.github.io/posts/7-manage-nodejs-heap-in-docker/</guid><description>&lt;h2 id="container-è¨˜æ†¶é«”èª¿æ•´">Container è¨˜æ†¶é«”èª¿æ•´ &lt;a href="#container-%e8%a8%98%e6%86%b6%e9%ab%94%e8%aa%bf%e6%95%b4" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ local èª¿æ•´ container è¨˜æ†¶é«”å¦‚ä¸‹&lt;/p>
&lt;pre tabindex="0">&lt;code>docker run --memory 1024m --interactive --tty ravali1906/dockermemory bash
&lt;/code>&lt;/pre>&lt;p>ä½†æ˜¯é€™æ¨£æœƒæœ‰ä¸€å€‹å•é¡Œï¼Œæœ‰ç”±æ–¼ container default æœ‰ swapï¼Œæ‰€ä»¥å³ä¾¿ç”¨è¶…éŽä¹Ÿä¸æœƒOut of memory&lt;/p>
&lt;p>é€™æ®µç¨‹å¼ç¢¼ç¨‹å¼ç¢¼æœƒ allocate 1024MB&lt;/p>
&lt;pre tabindex="0">&lt;code>const buf = Buffer.alloc(+process.argv[2] * 1024 * 1024)
console.log(Math.round(buf.length / (1024 * 1024)))
console.log(Math.round(process.memoryUsage().rss / (1024 * 1024)))
&lt;/code>&lt;/pre>&lt;p>åŸ·è¡Œçµæžœ&lt;/p>
&lt;pre tabindex="0">&lt;code>$ node buffer_example 2000
2000
16
&lt;/code>&lt;/pre>&lt;p>ä»¥ä¸Šé€™æ®µç¨‹å¼ç¢¼æ˜¯åƒè€ƒ ref1 å…¶å¯¦æ˜¯æœ‰å•é¡Œçš„ Buffer.alloc ä¸¦ä¸æœƒç”¨ä½¿ç”¨åˆ° heap&lt;/p>
&lt;p>æˆ‘æœ‰é‡æ–°å¯¦ä½œä½†æ˜¯é‚„ä¸å®Œæ•´&amp;hellip;..&lt;/p>
&lt;ul>
&lt;li>memoryUsage æœ‰å››å€‹è³‡è¨Š
&lt;ol>
&lt;li>heapTotal and heapUsed refer to V8&amp;rsquo;s memory usage.&lt;/li>
&lt;li>external refers to the memory usage of C++ objects bound to JavaScript objects managed by V8.&lt;/li>
&lt;li>rss, Resident Set Size, is the amount of space occupied in the main memory device (that is a subset of the total allocated memory) for the process, including all C++ and JavaScript objects and code.&lt;/li>
&lt;li>arrayBuffers refers to memory allocated for ArrayBuffers and SharedArrayBuffers, including all Node.js Buffers. This is also included in the external value. When Node.js is used as an embedded library, this value may be 0 because allocations for ArrayBuffers may not be tracked in that case.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;p>å¦‚æžœè¦æª¢æŸ¥ container çš„è¨˜æ†¶é«”å¤§å°å¯ä»¥çœ‹é€™è£¡&lt;/p></description></item></channel></rss>